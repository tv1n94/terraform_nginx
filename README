Данная конфигурация позволяет развернуть виртуальную машину (Ubuntu 20.04) в провайдере Advanced Hosting (AH), далее, с помощую Ansible будет установлен nginx последней версии

Требования для запуска данной конфигурации: 
-Наличие Linux-машины
-Установленные пакеты Ansible и Terraform.
-Аккаунт в Advanced Hosting, c добавленым токеном и ssh fingerprint


Описание файлов:
-main.tf - главный файл для terraform. Указываем наш провайдер и токен для работы с провайдером. 
-variables.tf - описание типов всех переменных
-vm.tf - файл, с описанием ВМ
-terraform.tfvars - файл, в котором хранятся все значения переменных. НУЖНО ЗАПОЛНИТЬ ПЕРЕД запуском команды terraform apply
-template.tf - сценарий, в котором содержится инструкция по выводу всех адресов в файл hosts
-output.tf - terraform-сценарий, который выводит нам IP-адрес созданной виртуальной машины
-provision.yml - Ansible-playbook для установки Nginx


Как развернуть виртуальную машину: 
1) На подготовленную Linux-машину копируем все файлы (main.tf, variables.tf, vm.tf, terraform.tfvars, template.tf, output.tf, provision.yml)
2) Открываем файл terraform.tfvars и вносим следующие значения параметров:
  -ah_dc - можно указать значение ams1 (Дата-центр в Амстердаме) или ash1 (Дата-центр в Америке)
  -ah_token - указываем значение из AH - API - Manage API access tokens
  -ah_machine_type - указываем тип машины, например "start-l" все типы можно посмотреть в  AH - API - Slugs - Cloud Servers
  -ah_image_type - "ubuntu-20_04-x64", список всех образов можно посмотреть в AH - API - Slugs - Images

3) В файле vm.tf в разделе указываем fingerprint вашего ключа из AH - SSH KEYS

4) Находясь в каталоге, выполняем команду terraform plan. Данная команда поможет проверить, не было ли допущено ошибок

5) Выполняем команду terraform apply -auto-approve
Будет развернута ВМ Ubuntu 20 и, с помощью Ansible будет установлен Nginx. 
В момент выполения команд надо будет ввести yes, чтобы машины могли обменяться между собой ключами.



Проверка корректного выполнения скрипта:
В конце выполнения скрипта или в файле hosts смотрим ip-адрес ВМ и копируем его в браузер. Должна открыться тестовая страница Nginx.


Удаление ВМ:
Для удаления ВМ достаточно ввести команду: terraform destroy -auto-approve